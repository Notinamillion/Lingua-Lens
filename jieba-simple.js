/**
 * Simplified Chinese word segmentation for Chrome extension
 * Based on Maximum Matching algorithm (similar to jieba)
 */

const JiebaSimple = {
  // Common Chinese words dictionary (expanded from compound-words.js)
  dictionary: new Set([
    // From compound-words.js - Pronouns
    '她的', '他的', '我的', '你的', '我们', '他们', '它们', '她', '他', '我', '你',
    '这个', '那个', '这些', '那些', '什么', '哪个', '谁', '怎么', '为什么',

    // Government & Politics (expanded)
    '预算', '预算案', '政府', '议会', '国会', '首相', '总统', '财政', '部长', '议员',
    '选举', '投票', '税收', '经济', '财政大臣', '内阁', '党员', '工党', '保守党',
    '议会党团', '下议院', '上议院', '国会议员', '执政党', '反对党', '政治', '政策',

    // Verbs - Communication & Action
    '敦促', '呼吁', '要求', '警告', '宣布', '表示', '认为', '指出', '强调', '建议',
    '发表', '讲话', '告诉', '说', '讨论', '支持', '继续', '担任', '赢得', '誓言',
    '联合', '团结', '坚持', '反对', '批评', '赞成', '同意', '拒绝', '接受', '提出',
    '推动', '加强', '提高', '确保', '实现', '完成', '开始', '结束', '进行', '举行',

    // Time & Frequency
    '今天', '明天', '昨天', '现在', '以前', '以后', '时候', '星期', '月份', '年份',
    '周一', '周二', '周三', '周四', '周五', '周六', '周日', '晚上', '早上', '中午',
    '未来', '几年', '几天', '几个', '一些', '许多', '所有', '每个', '任何', '没有',

    // Modal & Auxiliary Verbs
    '可以', '应该', '必须', '需要', '想要', '希望', '能够', '愿意', '应当', '可能',
    '会', '将', '已经', '正在', '刚刚', '马上', '立即', '即将', '曾经', '一直',

    // Conjunctions & Connectives
    '因为', '所以', '但是', '如果', '虽然', '然而', '而且', '或者', '并且', '还是',
    '关于', '对于', '根据', '按照', '通过', '为了', '由于', '除了', '除非', '尽管',
    '不仅', '不但', '无论', '不管', '只要', '只有', '就是', '也就是说', '换句话说',

    // Organizations & Institutions
    '公司', '工作', '学校', '大学', '医院', '警察', '军队', '企业', '机构', '组织',
    '委员会', '部门', '办公室', '中心', '协会', '联盟', '团体', '法院', '银行',

    // Economics & Finance
    '市场', '投资', '增长', '税收', '预算', '支出', '收入', '经费', '资金', '财务',
    '价格', '成本', '利润', '损失', '债务', '贷款', '利率', '通胀', '经济', '金融',

    // Places & Locations
    '英国', '中国', '美国', '法国', '德国', '日本', '加拿大', '澳大利亚', '欧洲',
    '伦敦', '北京', '华盛顿', '巴黎', '柏林', '东京', '国家', '城市', '地区',

    // Common Nouns
    '人民', '社会', '发展', '问题', '情况', '方面', '方式', '措施', '计划', '目标',
    '结果', '影响', '作用', '效果', '意义', '价值', '利益', '权利', '责任', '义务',
    '改革', '建设', '管理', '服务', '科技', '教育', '文化', '环境', '资源', '能源',

    // Adjectives & Adverbs
    '重要', '主要', '关键', '核心', '基本', '根本', '全面', '综合', '具体', '详细',
    '严格', '严重', '特殊', '一般', '普通', '共同', '不同', '相同', '类似', '相反',
    '一起', '共同', '单独', '分别', '直接', '间接', '公开', '秘密', '正式', '非正式',

    // Quantities & Measures
    '全部', '部分', '大部分', '小部分', '多数', '少数', '一半', '四分之一', '三分之一',
    '百分之', '数量', '规模', '范围', '程度', '水平', '标准', '比例', '速度', '幅度',

    // Additional Political Terms from example
    '成员', '劳工', '下届', '大选', '会议', '上', '表现', '公布', '准备', '密切',
    '关注', '认同', '支出', '计划', '整体', '方案', '挑选', '喜欢', '不喜欢',

    // Names (common in news)
    '瑞秋', '里夫斯', '特朗普', '拜登', '约翰逊', '苏纳克', '习近平', '普京',

    // More Common Verbs (100+)
    '做', '看', '听', '说话', '写', '读', '吃', '喝', '走', '跑', '来', '去', '到', '从',
    '给', '拿', '买', '卖', '用', '找', '见', '等', '送', '带', '放', '开', '关', '打',
    '叫', '问', '答', '回答', '说明', '解释', '介绍', '帮助', '帮忙', '工作', '学习',
    '教', '研究', '发现', '发明', '创造', '制作', '生产', '建立', '成立', '设立',
    '决定', '选择', '考虑', '打算', '计划', '准备', '开始', '继续', '停止', '结束',
    '改变', '变化', '发展', '增加', '减少', '提高', '降低', '扩大', '缩小', '延长',
    '保持', '维持', '保护', '保存', '节省', '浪费', '利用', '使用', '应用', '采用',
    '包括', '包含', '含有', '拥有', '具有', '属于', '代表', '象征', '意味着', '表明',
    '显示', '说明', '证明', '表现', '体现', '反映', '影响', '导致', '造成', '引起',
    '产生', '出现', '发生', '进行', '实行', '执行', '履行', '完成', '达到', '获得',

    // More Nouns (100+)
    '时间', '地方', '地点', '位置', '东西', '事情', '工具', '方法', '办法', '道路',
    '街道', '房子', '房间', '家', '门', '窗户', '桌子', '椅子', '床', '书', '笔',
    '纸', '电话', '电脑', '手机', '车', '火车', '飞机', '船', '自行车', '汽车',
    '食物', '水', '茶', '咖啡', '米饭', '面包', '蔬菜', '水果', '肉', '鱼', '鸡蛋',
    '衣服', '鞋', '帽子', '眼镜', '手表', '钱', '钱包', '银行卡', '护照', '身份证',
    '朋友', '家人', '父母', '父亲', '母亲', '儿子', '女儿', '哥哥', '弟弟', '姐姐',
    '妹妹', '老师', '学生', '同学', '同事', '老板', '员工', '医生', '护士', '警察',
    '天气', '太阳', '月亮', '星星', '云', '雨', '雪', '风', '温度', '季节', '春天',
    '夏天', '秋天', '冬天', '早晨', '上午', '下午', '傍晚', '夜晚', '半夜', '白天',
    '颜色', '红色', '蓝色', '绿色', '黄色', '黑色', '白色', '灰色', '粉色', '紫色',

    // More Adjectives (100+)
    '好', '坏', '大', '小', '多', '少', '高', '低', '长', '短', '新', '旧', '快', '慢',
    '早', '晚', '远', '近', '深', '浅', '厚', '薄', '宽', '窄', '胖', '瘦', '强', '弱',
    '冷', '热', '温暖', '凉爽', '干', '湿', '干净', '脏', '整齐', '乱', '简单', '复杂',
    '容易', '困难', '轻', '重', '硬', '软', '光滑', '粗糙', '明亮', '黑暗', '清楚',
    '模糊', '正确', '错误', '真', '假', '对', '错', '是', '非', '成功', '失败',
    '安全', '危险', '健康', '生病', '高兴', '伤心', '快乐', '痛苦', '满意', '不满',
    '有趣', '无聊', '有用', '无用', '美丽', '丑陋', '漂亮', '好看', '难看', '可爱',
    '可怕', '可怜', '奇怪', '普通', '特别', '一般', '平常', '正常', '异常', '优秀',
    '良好', '不错', '糟糕', '可以', '行', '不行', '合适', '不合适', '方便', '不方便',
    '必要', '不必要', '可能', '不可能', '一定', '肯定', '确定', '不确定', '清楚',

    // More Prepositions & Particles (50+)
    '在', '到', '从', '向', '往', '朝', '对', '跟', '和', '与', '同', '为', '被', '把',
    '将', '让', '使', '叫', '请', '给', '替', '比', '像', '如', '似', '以', '用', '凭',
    '靠', '经', '由', '自', '从', '随', '沿', '顺', '按', '依', '据', '照', '关于',
    '对于', '至于', '除了', '除', '连', '即使', '就算', '哪怕', '不管', '无论',

    // Numbers & Quantifiers (50+)
    '一', '二', '三', '四', '五', '六', '七', '八', '九', '十', '百', '千', '万', '亿',
    '第一', '第二', '第三', '两', '双', '半', '零', '几', '些', '点', '个', '位', '名',
    '条', '张', '只', '头', '匹', '本', '册', '支', '根', '把', '件', '套', '副', '双',
    '对', '台', '辆', '架', '座', '栋', '层', '间', '块', '片', '张', '幅', '份',

    // More Time Expressions (30+)
    '刚才', '刚刚', '马上', '立刻', '立即', '即刻', '当时', '那时', '这时', '同时',
    '平时', '有时', '时常', '经常', '常常', '总是', '一直', '始终', '从来', '永远',
    '暂时', '临时', '偶尔', '有时候', '每次', '这次', '那次', '上次', '下次', '首次',

    // More Question Words & Interjections (20+)
    '什么', '怎么', '为什么', '哪里', '哪儿', '谁', '哪', '几', '多少', '多久', '多长',
    '如何', '怎样', '怎么样', '好吗', '行吗', '是吗', '对吗', '呢', '吗', '啊', '吧',

    // Common Phrases & Idioms (50+)
    '不过', '不然', '否则', '然后', '接着', '于是', '因此', '因而', '所以', '那么',
    '这样', '那样', '怎样', '这么', '那么', '多么', '如此', '非常', '很', '太', '极',
    '十分', '特别', '相当', '比较', '稍微', '有点', '一点', '一些', '某些', '另外',
    '其他', '别的', '各种', '各样', '种种', '如何', '总之', '总的来说', '一般来说',
    '换句话说', '也就是说', '比如', '例如', '譬如', '等等', '之类', '以及', '以至',

    // Internet & Modern Terms (30+)
    '网络', '互联网', '网站', '网页', '邮件', '信息', '消息', '新闻', '报道', '文章',
    '视频', '图片', '照片', '声音', '音乐', '电影', '节目', '频道', '平台', '系统',
    '软件', '应用', '程序', '数据', '文件', '文档', '账号', '密码', '登录', '注册'
  ]),

  /**
   * Segment Chinese text using Maximum Matching algorithm
   * @param {string} text - Chinese text to segment
   * @param {number} maxWordLen - Maximum word length to try (default 4)
   * @returns {Array<string>} Array of segmented words
   */
  cut(text, maxWordLen = 4) {
    if (!text) return [];

    const result = [];
    let i = 0;

    while (i < text.length) {
      const char = text[i];

      // Skip whitespace and punctuation - keep as-is
      if (char.match(/[\s\p{P}]/u)) {
        result.push(char);
        i++;
        continue;
      }

      // Skip non-Chinese characters (English, numbers, etc.)
      if (!this.isChinese(char)) {
        // Collect consecutive non-Chinese characters
        let nonChineseSeq = char;
        i++;
        while (i < text.length && !this.isChinese(text[i]) && !text[i].match(/[\s\p{P}]/u)) {
          nonChineseSeq += text[i];
          i++;
        }
        result.push(nonChineseSeq);
        continue;
      }

      // Try maximum matching for Chinese characters
      let matched = false;

      // Try longest match first (4 chars, 3 chars, 2 chars)
      for (let len = Math.min(maxWordLen, text.length - i); len >= 2; len--) {
        const word = text.substring(i, i + len);

        if (this.dictionary.has(word)) {
          result.push(word);
          i += len;
          matched = true;
          break;
        }
      }

      // If no match found, take single character
      if (!matched) {
        result.push(char);
        i++;
      }
    }

    return result;
  },

  /**
   * Check if a character is Chinese
   * @param {string} char - Character to check
   * @returns {boolean}
   */
  isChinese(char) {
    const code = char.charCodeAt(0);
    // CJK Unified Ideographs range
    return (code >= 0x4E00 && code <= 0x9FFF) ||
           (code >= 0x3400 && code <= 0x4DBF) ||
           (code >= 0x20000 && code <= 0x2A6DF);
  },

  /**
   * Add words to dictionary
   * @param {Array<string>} words - Words to add
   */
  addWords(words) {
    words.forEach(word => this.dictionary.add(word));
  },

  /**
   * Remove words from dictionary
   * @param {Array<string>} words - Words to remove
   */
  removeWords(words) {
    words.forEach(word => this.dictionary.delete(word));
  }
};

// Make available globally for Chrome extension
if (typeof self !== 'undefined') {
  self.JiebaSimple = JiebaSimple;
}

console.log('[Jieba Simple] Loaded dictionary with', JiebaSimple.dictionary.size, 'words (significantly expanded dictionary)');
